<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Academic Journey - Mario Style CGPA Reveal</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #5c94fc;
      font-family: 'Press Start 2P', monospace;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <script>
    // =========================================
    // Academic Journey - Phaser 3 Game
    // =========================================

    // Semester CGPA data
    const semesterData = [
      { sem: 1, sgpa: 9.0 },
      { sem: 2, sgpa: 8.8 },
      { sem: 3, sgpa: 9.1 },
      { sem: 4, sgpa: 9.5 },
      { sem: 5, sgpa: 9.2 },
      { sem: 6, sgpa: 9.4 },
      { sem: 7, sgpa: 9.0 },
      { sem: 8, sgpa: 9.8 },
      { sem: 9, sgpa: 9.5 },
      { sem: 10, sgpa: 9.7 }
    ];

    const GAME_WIDTH = 960;
    const GAME_HEIGHT = 540;
    const WORLD_WIDTH = 2200;
    const GROUND_Y = 460;

    // Simple WebAudio beep for block hit (no external assets)
    function playBeep(freq = 660, duration = 0.08) {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'square';
        osc.frequency.value = freq;
        gain.gain.value = 0.15;
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + duration);
      } catch (e) {
        // Audio context may be blocked; ignore
      }
    }

    class AcademicJourneyScene extends Phaser.Scene {
      constructor() {
        super('AcademicJourney');
      }

      preload() {
        // Create a placeholder sprite sheet (3 frames) via canvas
        const sheetCanvas = document.createElement('canvas');
        sheetCanvas.width = 96; // 3 frames * 32px
        sheetCanvas.height = 32;
        const ctx = sheetCanvas.getContext('2d');

        // Frame 1: idle
        ctx.fillStyle = '#d32f2f';
        ctx.fillRect(6, 8, 20, 20);
        ctx.fillStyle = '#f5c542';
        ctx.fillRect(10, 4, 12, 8);

        // Frame 2: run1
        ctx.fillStyle = '#d32f2f';
        ctx.fillRect(38, 8, 20, 20);
        ctx.fillStyle = '#f5c542';
        ctx.fillRect(42, 4, 12, 8);
        ctx.fillStyle = '#000000';
        ctx.fillRect(36, 26, 8, 4);

        // Frame 3: run2
        ctx.fillStyle = '#d32f2f';
        ctx.fillRect(70, 8, 20, 20);
        ctx.fillStyle = '#f5c542';
        ctx.fillRect(74, 4, 12, 8);
        ctx.fillStyle = '#000000';
        ctx.fillRect(86, 26, 8, 4);

        const dataURL = sheetCanvas.toDataURL();
        this.load.spritesheet('player', dataURL, { frameWidth: 32, frameHeight: 32 });
      }

      create() {
        // Background
        this.cameras.main.setBackgroundColor('#5c94fc');

        // World bounds
        this.physics.world.setBounds(0, 0, WORLD_WIDTH, GAME_HEIGHT);
        this.cameras.main.setBounds(0, 0, WORLD_WIDTH, GAME_HEIGHT);

        // Title & subtitle (fixed to camera)
        this.add.text(GAME_WIDTH / 2, 24, 'ACADEMIC JOURNEY', {
          fontSize: '20px',
          color: '#ffffff',
          stroke: '#000000',
          strokeThickness: 4
        }).setOrigin(0.5).setScrollFactor(0);

        this.add.text(GAME_WIDTH / 2, 52, 'Level 1-1: GPA Tracker', {
          fontSize: '10px',
          color: '#ffffff',
          stroke: '#000000',
          strokeThickness: 3
        }).setOrigin(0.5).setScrollFactor(0);

        // Ground
        this.ground = this.add.rectangle(WORLD_WIDTH / 2, GROUND_Y + 36, WORLD_WIDTH, 80, 0xd45b12);
        this.physics.add.existing(this.ground, true);

        // Player
        this.player = this.physics.add.sprite(80, GROUND_Y - 40, 'player', 0);
        this.player.setCollideWorldBounds(true);
        this.player.setGravityY(900);
        this.player.setDragX(1200);
        this.player.setMaxVelocity(220, 600);

        // Camera follow
        this.cameras.main.startFollow(this.player, true, 0.08, 0.08);

        // Collide player with ground
        this.physics.add.collider(this.player, this.ground);

        // Controls
        this.cursors = this.input.keyboard.createCursorKeys();
        this.spaceKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

        // Animations
        this.anims.create({
          key: 'idle',
          frames: [{ key: 'player', frame: 0 }],
          frameRate: 1
        });
        this.anims.create({
          key: 'run',
          frames: [
            { key: 'player', frame: 1 },
            { key: 'player', frame: 2 }
          ],
          frameRate: 8,
          repeat: -1
        });
        this.anims.create({
          key: 'jump',
          frames: [{ key: 'player', frame: 0 }],
          frameRate: 1
        });

        // Blocks group
        this.blocks = this.physics.add.staticGroup();
        this.blockMeta = new Map();

        const startX = 300;
        const spacing = 140;
        const blockY = 280;

        semesterData.forEach((data, idx) => {
          const x = startX + idx * spacing;

          const block = this.add.rectangle(x, blockY, 48, 48, 0xfb923c).setStrokeStyle(4, 0x000000);
          this.blocks.add(block);

          // Question mark
          const q = this.add.text(x, blockY - 6, '?', {
            fontSize: '24px',
            color: '#ffffff',
            stroke: '#000000',
            strokeThickness: 4
          }).setOrigin(0.5);

          // Semester label
          this.add.text(x, blockY + 48, `Sem ${data.sem}`, {
            fontSize: '8px',
            color: '#ffffff',
            stroke: '#000000',
            strokeThickness: 3
          }).setOrigin(0.5);

          // SGPA reveal (hidden initially)
          const sgpaText = this.add.text(x, blockY - 52, data.sgpa.toFixed(1), {
            fontSize: '12px',
            color: '#ffffff',
            stroke: '#000000',
            strokeThickness: 3
          }).setOrigin(0.5);
          sgpaText.setAlpha(0);

          this.blockMeta.set(block, {
            triggered: false,
            sgpaText,
            qText: q
          });
        });

        // Collider: player hits blocks
        this.physics.add.collider(this.player, this.blocks, this.onBlockHit, null, this);

        // Flag pole
        this.flagPole = this.add.rectangle(WORLD_WIDTH - 120, GROUND_Y - 80, 10, 200, 0x2e7d32)
          .setStrokeStyle(2, 0x000000);
        this.physics.add.existing(this.flagPole, true);

        this.flag = this.add.triangle(WORLD_WIDTH - 100, GROUND_Y - 150, 0, 0, 40, 15, 0, 30, 0xffffff)
          .setStrokeStyle(2, 0x000000);

        // Flag base
        this.flagBase = this.add.rectangle(WORLD_WIDTH - 120, GROUND_Y + 8, 40, 40, 0x7c7c7c)
          .setStrokeStyle(2, 0x000000);

        // End text (hidden)
        this.endText = this.add.text(WORLD_WIDTH - 240, GROUND_Y - 210, 'LEVEL COMPLETE!', {
          fontSize: '12px',
          color: '#ffffff',
          stroke: '#000000',
          strokeThickness: 3
        }).setAlpha(0);

        // End overlap
        this.physics.add.overlap(this.player, this.flagPole, this.onReachFlag, null, this);
      }

      onBlockHit(player, block) {
        const meta = this.blockMeta.get(block);
        if (!meta || meta.triggered === true) return;

        // Only trigger if player hits from below
        if (player.body.velocity.y < 0 && player.body.touching.up && block.body.touching.down) {
          meta.triggered = true;

          // Bounce animation
          this.tweens.add({
            targets: block,
            y: block.y - 8,
            duration: 100,
            yoyo: true,
            ease: 'Quad.easeOut'
          });

          // Reveal SGPA
          this.tweens.add({
            targets: meta.sgpaText,
            alpha: 1,
            y: meta.sgpaText.y - 12,
            duration: 200,
            ease: 'Quad.easeOut'
          });

          playBeep(740, 0.08);
        }
      }

      onReachFlag() {
        if (this.levelComplete) return;
        this.levelComplete = true;

        this.player.setVelocity(0, 0);
        this.player.anims.play('idle', true);

        // Flag slide down
        this.tweens.add({
          targets: this.flag,
          y: this.flag.y + 120,
          duration: 600,
          ease: 'Quad.easeOut'
        });

        // Show end text
        this.tweens.add({
          targets: this.endText,
          alpha: 1,
          duration: 400,
          ease: 'Linear'
        });

        playBeep(520, 0.2);

        // Smooth fade transition
        this.cameras.main.fade(700, 0, 0, 0, false, (camera, progress) => {
          if (progress === 1) {
            this.cameras.main.fadeIn(700, 0, 0, 0);
          }
        });
      }

      update() {
        if (this.levelComplete) return;

        const onGround = this.player.body.blocked.down || this.player.body.touching.down;

        // Horizontal movement with smooth acceleration
        if (this.cursors.left.isDown) {
          this.player.setAccelerationX(-1000);
          this.player.setFlipX(true);
        } else if (this.cursors.right.isDown) {
          this.player.setAccelerationX(1000);
          this.player.setFlipX(false);
        } else {
          this.player.setAccelerationX(0);
        }

        // Jump (Up Arrow or Space)
        if ((this.cursors.up.isDown || this.spaceKey.isDown) && onGround) {
          this.player.setVelocityY(-420);
        }

        // Animation handling
        if (!onGround) {
          this.player.anims.play('jump', true);
        } else if (Math.abs(this.player.body.velocity.x) > 10) {
          this.player.anims.play('run', true);
        } else {
          this.player.anims.play('idle', true);
        }
      }
    }

    // Phaser game config
    const config = {
      type: Phaser.AUTO,
      width: GAME_WIDTH,
      height: GAME_HEIGHT,
      pixelArt: true,
      backgroundColor: '#5c94fc',
      physics: {
        default: 'arcade',
        arcade: {
          gravity: { y: 0 },
          debug: false
        }
      },
      scene: [AcademicJourneyScene]
    };

    new Phaser.Game(config);
  </script>
</body>
</html>
